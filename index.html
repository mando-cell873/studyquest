<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StudyQuest</title>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@700;900&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0d0f1a; --surface:#141628; --card:#1a1e35; --border:#252a45;
  --accent:#f0c040; --accent2:#e05a8a; --accent3:#40c8f0;
  --text:#e8eaf6; --dim:#7a84b8; --xp:#5affa0;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(1px 1px at 20% 30%,rgba(255,255,255,0.6) 0%,transparent 100%),radial-gradient(1px 1px at 80% 10%,rgba(255,255,255,0.5) 0%,transparent 100%),radial-gradient(1px 1px at 50% 80%,rgba(255,255,255,0.4) 0%,transparent 100%),radial-gradient(1.5px 1.5px at 35% 15%,rgba(240,192,64,0.4) 0%,transparent 100%),radial-gradient(1.5px 1.5px at 65% 70%,rgba(64,200,240,0.4) 0%,transparent 100%);pointer-events:none;z-index:0;}
.wrap{max-width:480px;margin:0 auto;padding:20px 16px 40px;position:relative;z-index:1;}
.head{text-align:center;margin-bottom:24px;}
.head h1{font-family:'Zen Maru Gothic',sans-serif;font-size:2rem;font-weight:900;background:-webkit-linear-gradient(135deg,#f0c040,#e05a8a);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.head p{color:var(--dim);font-size:0.8rem;margin-top:4px;}
.card{background:var(--card);border:1px solid var(--border);border-radius:24px;padding:20px;margin-bottom:16px;}
.card h2{font-family:'Zen Maru Gothic',sans-serif;font-size:0.9rem;color:var(--dim);margin-bottom:14px;letter-spacing:0.1em;}
/* Character */
.char-top{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;gap:20px;margin-bottom:20px;}
.char-avatar{width:96px;height:96px;position:relative;-webkit-flex-shrink:0;flex-shrink:0;}
.char-avatar svg{width:100%;height:100%;display:block;-webkit-filter:drop-shadow(0 0 8px rgba(100,200,255,0.5));filter:drop-shadow(0 0 8px rgba(100,200,255,0.5));}
.cstage{position:absolute;top:0;left:0;width:100%;height:100%;}
.char-info{-webkit-flex:1;flex:1;min-width:0;}
.char-name{font-family:'Zen Maru Gothic',sans-serif;font-size:1.3rem;font-weight:700;color:var(--accent);margin-bottom:2px;}
.char-title{font-size:0.72rem;color:var(--accent2);background:rgba(224,90,138,0.15);border:1px solid rgba(224,90,138,0.3);border-radius:20px;padding:2px 10px;display:inline-block;margin-bottom:8px;}
.char-lv{font-size:0.75rem;color:var(--dim);}
.char-lv span{font-size:1.4rem;font-weight:700;color:var(--text);font-family:'Zen Maru Gothic',sans-serif;}
/* XP */
.xp-labels{display:-webkit-flex;display:flex;-webkit-justify-content:space-between;justify-content:space-between;font-size:0.72rem;color:var(--dim);margin-bottom:6px;}
.xp-labels span:last-child{color:var(--xp);}
.xp-bg{height:8px;background:var(--border);border-radius:10px;overflow:hidden;}
.xp-fill{height:100%;background:-webkit-linear-gradient(left,#5affa0,#00e8a0);background:linear-gradient(to right,#5affa0,#00e8a0);border-radius:10px;-webkit-transition:width 0.8s;transition:width 0.8s;-webkit-box-shadow:0 0 8px rgba(90,255,160,0.5);box-shadow:0 0 8px rgba(90,255,160,0.5);}
/* Stats */
.stats{display:-webkit-flex;display:flex;-webkit-flex-wrap:wrap;flex-wrap:wrap;gap:10px;margin-top:16px;}
.stat{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:10px;text-align:center;-webkit-flex:1 1 calc(50% - 5px);flex:1 1 calc(50% - 5px);}
.stat-icon{font-size:1.2rem;}
.stat-val{font-family:'Zen Maru Gothic',sans-serif;font-size:1.1rem;font-weight:700;color:var(--text);line-height:1.2;}
.stat-val span{font-size:0.6rem;}
.stat-lbl{font-size:0.65rem;color:var(--dim);margin-top:2px;}
.stat-avg{border-color:rgba(64,200,240,0.3);background:rgba(64,200,240,0.05);}
.stat-avg .stat-val{color:var(--accent3);}
/* Subjects */
.subj-row{display:-webkit-flex;display:flex;gap:8px;-webkit-flex-wrap:wrap;flex-wrap:wrap;margin-bottom:20px;}
.subj-btn{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:6px 14px;font-size:0.78rem;color:var(--dim);cursor:pointer;font-family:'Noto Sans JP',sans-serif;-webkit-tap-highlight-color:transparent;}
.subj-btn.active{background:rgba(240,192,64,0.15);border-color:var(--accent);color:var(--accent);}
/* Piano */
.piano-panel{background:rgba(200,120,224,0.08);border:1px solid rgba(200,120,224,0.3);border-radius:16px;padding:16px;margin-bottom:20px;}
.piano-panel label{font-size:0.72rem;color:var(--dim);display:block;margin-bottom:5px;}
.piano-panel input,.piano-panel textarea{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:8px 12px;color:var(--text);font-family:'Noto Sans JP',sans-serif;font-size:0.82rem;outline:none;-webkit-appearance:none;}
.piano-panel textarea{resize:none;}
.diff-row{display:-webkit-flex;display:flex;gap:6px;}
.diff-btn{-webkit-flex:1;flex:1;padding:6px 4px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--dim);font-size:0.72rem;cursor:pointer;font-family:'Noto Sans JP',sans-serif;-webkit-tap-highlight-color:transparent;}
.diff-btn.active{background:rgba(200,120,224,0.15);border-color:rgba(200,120,224,0.4);color:#c878e0;}
.xp-rate{font-family:'Zen Maru Gothic',sans-serif;font-size:1.2rem;color:#c878e0;font-weight:700;text-align:center;padding:4px;}
/* Timer */
.timer-display{font-family:'Zen Maru Gothic',sans-serif;font-size:4rem;font-weight:900;letter-spacing:0.05em;color:var(--text);text-align:center;margin-bottom:4px;line-height:1;-webkit-transition:color 0.3s;transition:color 0.3s;}
.timer-display.running{color:var(--accent3);}
.timer-sub{font-size:0.75rem;color:var(--dim);text-align:center;margin-bottom:20px;}
.timer-btns{display:-webkit-flex;display:flex;gap:12px;-webkit-justify-content:center;justify-content:center;}
.btn{border:none;border-radius:50px;padding:12px 28px;font-family:'Noto Sans JP',sans-serif;font-size:0.9rem;font-weight:700;cursor:pointer;-webkit-tap-highlight-color:transparent;}
.btn-start{background:-webkit-linear-gradient(135deg,#f0c040,#f0a020);background:linear-gradient(135deg,#f0c040,#f0a020);color:#0d0f1a;-webkit-box-shadow:0 4px 20px rgba(240,192,64,0.3);box-shadow:0 4px 20px rgba(240,192,64,0.3);}
.btn-stop{background:rgba(224,90,138,0.2);color:var(--accent2);border:1px solid rgba(224,90,138,0.4);}
.btn-reset{background:var(--surface);color:var(--dim);border:1px solid var(--border);padding:12px 18px;}
/* Log */
.log-item{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;gap:12px;padding:10px 14px;background:var(--surface);border-radius:12px;border:1px solid var(--border);margin-bottom:8px;-webkit-flex-wrap:wrap;flex-wrap:wrap;}
.log-dot{width:8px;height:8px;border-radius:50%;-webkit-flex-shrink:0;flex-shrink:0;}
.log-subj{-webkit-flex:1;flex:1;font-size:0.85rem;}
.log-time{font-size:0.8rem;color:var(--dim);}
.log-xp{font-size:0.75rem;color:var(--xp);font-weight:700;}
.empty-log{text-align:center;color:var(--dim);font-size:0.8rem;padding:16px;}
/* Ach */
.ach-grid{display:-webkit-flex;display:flex;-webkit-flex-wrap:wrap;flex-wrap:wrap;gap:8px;}
.ach-item{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:10px 6px;text-align:center;width:calc(25% - 6px);}
.ach-item.on{border-color:rgba(240,192,64,0.4);background:rgba(240,192,64,0.05);}
.ach-icon{font-size:1.6rem;-webkit-filter:grayscale(100%);filter:grayscale(100%);}
.ach-item.on .ach-icon{-webkit-filter:none;filter:none;}
.ach-name{font-size:0.6rem;color:var(--dim);margin-top:4px;line-height:1.3;}
.ach-item.on .ach-name{color:var(--accent);}

/* Overlaysï¼ˆâ˜…å›ºã¾ã‚Šå¯¾ç­–ï¼šshowæ™‚ã ã‘flex + pointer-eventsï¼‰ */
.overlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  z-index:900;
  display:none;
  -webkit-overflow-scrolling:touch;
  pointer-events:none; /* éè¡¨ç¤ºæ™‚ã‚¯ãƒªãƒƒã‚¯ã‚’é€šã™ */
}
.overlay.show{display:block;pointer-events:auto;}
.lu-bg{
  background:rgba(0,0,0,0.85);
  -webkit-align-items:center;align-items:center;
  -webkit-justify-content:center;justify-content:center;
}
/* showæ™‚ã ã‘flex */
.overlay.lu-bg.show{display:-webkit-flex;display:flex;}

.lu-box{text-align:center;padding:20px;}
.lu-box .big{font-family:'Zen Maru Gothic',sans-serif;font-size:1rem;color:var(--accent2);letter-spacing:0.3em;margin-bottom:8px;}
.lu-box .lnum{font-family:'Zen Maru Gothic',sans-serif;font-size:6rem;font-weight:900;line-height:1;background:-webkit-linear-gradient(135deg,#f0c040,#e05a8a);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.lu-box .ltitle{font-size:1.1rem;color:var(--text);margin-top:8px;margin-bottom:8px;}
.lu-btns{display:-webkit-flex;display:flex;gap:10px;-webkit-justify-content:center;justify-content:center;-webkit-flex-wrap:wrap;flex-wrap:wrap;}
.lu-btn{border:none;border-radius:50px;padding:10px 22px;font-family:'Zen Maru Gothic',sans-serif;font-size:0.9rem;cursor:pointer;-webkit-tap-highlight-color:transparent;}

/* Toast */
.toast{position:fixed;top:20px;left:50%;-webkit-transform:translateX(-50%) translateY(-80px);transform:translateX(-50%) translateY(-80px);background:var(--card);border:1px solid var(--accent);border-radius:16px;padding:14px 24px;font-family:'Zen Maru Gothic',sans-serif;font-size:0.9rem;color:var(--accent);-webkit-transition:-webkit-transform 0.4s;transition:transform 0.4s;z-index:1000;white-space:nowrap;}
.toast.show{-webkit-transform:translateX(-50%) translateY(0);transform:translateX(-50%) translateY(0);}
/* Particles */
.particle{position:fixed;width:8px;height:8px;border-radius:2px;pointer-events:none;z-index:998;-webkit-animation:fall linear forwards;animation:fall linear forwards;}
@-webkit-keyframes fall{from{-webkit-transform:translateY(-10px) rotate(0deg);opacity:1;}to{-webkit-transform:translateY(100vh) rotate(720deg);opacity:0;}}
@keyframes fall{from{transform:translateY(-10px) rotate(0deg);opacity:1;}to{transform:translateY(100vh) rotate(720deg);opacity:0;}}
</style>
</head>
<body>
<div class="wrap">
  <div class="head"><h1>âœ¨ StudyQuest</h1><p>å‹‰å¼·ã—ã¦å†’é™ºè€…ã‚’è‚²ã¦ã‚ˆã†</p></div>

  <!-- Character Card -->
  <div class="card">
    <div class="char-top">
      <div class="char-avatar">

        <!-- Stage 1: Lv1-9 æœ¨ã®å‰£ãƒ»å¹³æ°‘æœ -->
        <svg id="cs1" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges">
          <ellipse cx="48" cy="90" rx="18" ry="3" fill="rgba(0,0,0,0.25)"/>
          <rect x="24" y="6" width="48" height="6" fill="#3d2b1a"/><rect x="18" y="12" width="6" height="12" fill="#3d2b1a"/><rect x="72" y="12" width="6" height="12" fill="#3d2b1a"/><rect x="24" y="12" width="12" height="6" fill="#3d2b1a"/><rect x="60" y="12" width="12" height="6" fill="#3d2b1a"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/>
          <rect x="30" y="24" width="12" height="12" fill="#fff"/><rect x="54" y="24" width="12" height="12" fill="#fff"/><rect x="36" y="24" width="6" height="12" fill="#1a1a6a"/><rect x="60" y="24" width="6" height="12" fill="#1a1a6a"/>
          <rect x="42" y="36" width="12" height="6" fill="#b07850"/>
          <rect x="30" y="42" width="6" height="6" fill="#3d2b1a"/><rect x="36" y="48" width="24" height="6" fill="#3d2b1a"/><rect x="60" y="42" width="6" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <rect x="18" y="60" width="60" height="30" fill="#4a9a40"/><rect x="18" y="60" width="6" height="30" fill="#3a7a30"/><rect x="72" y="60" width="6" height="30" fill="#3a7a30"/>
          <rect x="6" y="60" width="12" height="30" fill="#c8a070"/><rect x="6" y="60" width="6" height="30" fill="#b09060"/><rect x="78" y="60" width="12" height="30" fill="#c8a070"/>
          <rect x="18" y="90" width="24" height="24" fill="#3060c0"/><rect x="54" y="90" width="24" height="24" fill="#3060c0"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/>
          <rect x="18" y="114" width="24" height="6" fill="#2a1a0a"/><rect x="54" y="114" width="24" height="6" fill="#2a1a0a"/>
          <rect x="84" y="48" width="12" height="6" fill="#c8a060"/><rect x="84" y="54" width="12" height="24" fill="#a07840"/><rect x="78" y="60" width="6" height="6" fill="#c8a060"/><rect x="84" y="78" width="12" height="6" fill="#806030"/>
        </svg>

        <!-- Stage 2: Lv10-19 çŸ³ã®å‰£ãƒ»é©é˜²å…· -->
        <svg id="cs2" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="display:none">
          <ellipse cx="48" cy="90" rx="18" ry="3" fill="rgba(0,0,0,0.25)"/>
          <rect x="18" y="6" width="60" height="6" fill="#8a7060"/><rect x="12" y="10" width="6" height="12" fill="#8a7060"/><rect x="78" y="10" width="6" height="12" fill="#8a7060"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/><rect x="18" y="12" width="60" height="8" fill="#6a5040"/>
          <rect x="30" y="24" width="12" height="12" fill="#fff"/><rect x="54" y="24" width="12" height="12" fill="#fff"/><rect x="36" y="24" width="6" height="12" fill="#2a3a20"/><rect x="60" y="24" width="6" height="12" fill="#2a3a20"/>
          <rect x="30" y="42" width="6" height="6" fill="#3d2b1a"/><rect x="36" y="48" width="24" height="6" fill="#3d2b1a"/><rect x="60" y="42" width="6" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <rect x="18" y="60" width="60" height="30" fill="#a07850"/><rect x="18" y="60" width="6" height="30" fill="#806040"/><rect x="72" y="60" width="6" height="30" fill="#806040"/><rect x="24" y="72" width="48" height="6" fill="#806040"/>
          <rect x="6" y="60" width="12" height="30" fill="#a07850"/><rect x="6" y="60" width="6" height="30" fill="#806040"/><rect x="78" y="60" width="12" height="30" fill="#a07850"/>
          <rect x="18" y="90" width="24" height="24" fill="#705040"/><rect x="54" y="90" width="24" height="24" fill="#705040"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/>
          <rect x="18" y="114" width="24" height="6" fill="#4a3020"/><rect x="54" y="114" width="24" height="6" fill="#4a3020"/>
          <rect x="84" y="40" width="12" height="6" fill="#a09088"/><rect x="84" y="46" width="12" height="28" fill="#807868"/><rect x="78" y="52" width="6" height="6" fill="#a09088"/><rect x="84" y="74" width="12" height="6" fill="#605040"/>
        </svg>

        <!-- Stage 3: Lv20-29 é‰„ã®å‰£ãƒ»é‰„é˜²å…· -->
        <svg id="cs3" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="display:none">
          <ellipse cx="48" cy="90" rx="18" ry="3" fill="rgba(0,0,0,0.25)"/>
          <rect x="18" y="6" width="60" height="12" fill="#a8b8c0"/><rect x="12" y="12" width="6" height="18" fill="#a8b8c0"/><rect x="78" y="12" width="6" height="18" fill="#a8b8c0"/><rect x="18" y="18" width="60" height="6" fill="#8898a0"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/><rect x="18" y="12" width="60" height="12" fill="#8898a0"/>
          <rect x="30" y="24" width="12" height="12" fill="#fff"/><rect x="54" y="24" width="12" height="12" fill="#fff"/><rect x="36" y="24" width="6" height="12" fill="#1a3a6a"/><rect x="60" y="24" width="6" height="12" fill="#1a3a6a"/>
          <rect x="30" y="42" width="6" height="6" fill="#3d2b1a"/><rect x="36" y="48" width="24" height="6" fill="#3d2b1a"/><rect x="60" y="42" width="6" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <rect x="18" y="60" width="60" height="30" fill="#b0c0c8"/><rect x="18" y="60" width="6" height="30" fill="#90a0a8"/><rect x="72" y="60" width="6" height="30" fill="#90a0a8"/><rect x="24" y="60" width="48" height="6" fill="#d0e0e8"/><rect x="30" y="72" width="36" height="12" fill="#90a0a8"/>
          <rect x="6" y="60" width="12" height="30" fill="#b0c0c8"/><rect x="6" y="60" width="6" height="30" fill="#90a0a8"/><rect x="78" y="60" width="12" height="30" fill="#b0c0c8"/>
          <rect x="18" y="90" width="24" height="24" fill="#90a0a8"/><rect x="54" y="90" width="24" height="24" fill="#90a0a8"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/>
          <rect x="18" y="114" width="24" height="6" fill="#8090a0"/><rect x="54" y="114" width="24" height="6" fill="#8090a0"/>
          <rect x="84" y="36" width="12" height="6" fill="#c0c0c8"/><rect x="84" y="42" width="12" height="30" fill="#d8d8e0"/><rect x="78" y="48" width="6" height="6" fill="#a0a0a8"/><rect x="84" y="72" width="12" height="6" fill="#806040"/>
        </svg>

        <!-- Stage 4: Lv30-39 é‡‘ã®å‰£ãƒ»é‡‘é˜²å…· -->
        <svg id="cs4" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="display:none">
          <ellipse cx="48" cy="90" rx="18" ry="3" fill="rgba(0,0,0,0.3)"/>
          <rect x="18" y="4" width="60" height="14" fill="#e8c030"/><rect x="12" y="10" width="6" height="20" fill="#e8c030"/><rect x="78" y="10" width="6" height="20" fill="#e8c030"/><rect x="18" y="18" width="60" height="6" fill="#c0a020"/>
          <rect x="42" y="2" width="12" height="8" fill="#fff8a0"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/><rect x="18" y="12" width="60" height="12" fill="#c0a020"/>
          <rect x="30" y="24" width="12" height="12" fill="#fff"/><rect x="54" y="24" width="12" height="12" fill="#fff"/><rect x="36" y="24" width="6" height="12" fill="#806000"/><rect x="60" y="24" width="6" height="12" fill="#806000"/>
          <rect x="30" y="42" width="36" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <rect x="18" y="60" width="60" height="30" fill="#e8c030"/><rect x="18" y="60" width="6" height="30" fill="#c0a020"/><rect x="72" y="60" width="6" height="30" fill="#c0a020"/><rect x="24" y="60" width="48" height="6" fill="#fff8a0"/><rect x="30" y="72" width="36" height="12" fill="#c0a020"/><rect x="42" y="66" width="12" height="6" fill="#fff8a0"/>
          <rect x="6" y="60" width="12" height="30" fill="#e8c030"/><rect x="6" y="60" width="6" height="30" fill="#c0a020"/><rect x="78" y="60" width="12" height="30" fill="#e8c030"/>
          <rect x="18" y="90" width="24" height="24" fill="#c0a020"/><rect x="54" y="90" width="24" height="24" fill="#c0a020"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/>
          <rect x="18" y="114" width="24" height="6" fill="#e8c030"/><rect x="54" y="114" width="24" height="6" fill="#e8c030"/>
          <rect x="84" y="32" width="12" height="6" fill="#fff8a0"/><rect x="84" y="38" width="12" height="34" fill="#e8c030"/><rect x="78" y="44" width="6" height="6" fill="#fff8a0"/><rect x="84" y="72" width="12" height="6" fill="#806000"/>
        </svg>

        <!-- Stage 5: Lv40-49 ãƒ€ã‚¤ãƒ¤ã®å‰£ãƒ»ãƒ€ã‚¤ãƒ¤é˜²å…· -->
        <svg id="cs5" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="display:none">
          <ellipse cx="48" cy="90" rx="18" ry="3" fill="rgba(0,0,0,0.3)"/>
          <rect x="12" y="0" width="72" height="18" fill="#40d8e8"/><rect x="6" y="12" width="6" height="18" fill="#40d8e8"/><rect x="84" y="12" width="6" height="18" fill="#40d8e8"/><rect x="12" y="18" width="72" height="6" fill="#20b8c8"/><rect x="42" y="0" width="12" height="12" fill="#a0ffff"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/><rect x="18" y="12" width="60" height="12" fill="#20b8c8"/>
          <rect x="30" y="24" width="12" height="12" fill="#fff"/><rect x="54" y="24" width="12" height="12" fill="#fff"/><rect x="36" y="24" width="6" height="12" fill="#00e8ff"/><rect x="60" y="24" width="6" height="12" fill="#00e8ff"/>
          <rect x="30" y="42" width="36" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <rect x="12" y="60" width="72" height="30" fill="#40d8e8"/><rect x="12" y="60" width="6" height="30" fill="#20b8c8"/><rect x="78" y="60" width="6" height="30" fill="#20b8c8"/><rect x="18" y="60" width="60" height="6" fill="#80f0ff"/><rect x="30" y="72" width="36" height="12" fill="#20b8c8"/><rect x="42" y="66" width="12" height="6" fill="#a0ffff"/>
          <rect x="0" y="60" width="12" height="30" fill="#40d8e8"/><rect x="0" y="60" width="6" height="30" fill="#20b8c8"/><rect x="84" y="60" width="12" height="30" fill="#40d8e8"/>
          <rect x="12" y="90" width="30" height="24" fill="#30c8d8"/><rect x="54" y="90" width="30" height="24" fill="#30c8d8"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/>
          <rect x="12" y="114" width="30" height="6" fill="#40d8e8"/><rect x="54" y="114" width="30" height="6" fill="#40d8e8"/>
          <rect x="84" y="30" width="6" height="6" fill="#a0ffff"/><rect x="84" y="36" width="12" height="42" fill="#60e8ff"/><rect x="78" y="48" width="6" height="6" fill="#a0ffff"/><rect x="84" y="36" width="6" height="42" fill="#c0ffff"/><rect x="84" y="78" width="12" height="6" fill="#5050a0"/>
        </svg>

        <!-- Stage 6: Lv50-59 ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆãƒ€ã‚¤ãƒ¤ -->
        <svg id="cs6" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="display:none">
          <defs><radialGradient id="cg6" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#a0ffff" stop-opacity="0.2"/><stop offset="100%" stop-color="#a0ffff" stop-opacity="0"/></radialGradient></defs>
          <rect x="0" y="0" width="96" height="96" fill="url(#cg6)"/>
          <ellipse cx="48" cy="90" rx="18" ry="3" fill="rgba(0,0,0,0.3)"/>
          <rect x="12" y="0" width="72" height="18" fill="#40d8e8"/><rect x="6" y="12" width="6" height="18" fill="#40d8e8"/><rect x="84" y="12" width="6" height="18" fill="#40d8e8"/><rect x="12" y="18" width="72" height="6" fill="#20b8c8"/>
          <rect x="42" y="0" width="12" height="12" fill="#ffff80"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/><rect x="18" y="12" width="60" height="12" fill="#20b8c8"/>
          <rect x="30" y="24" width="12" height="12" fill="#fff"/><rect x="54" y="24" width="12" height="12" fill="#fff"/><rect x="36" y="24" width="6" height="12" fill="#8040ff"/><rect x="60" y="24" width="6" height="12" fill="#8040ff"/>
          <rect x="30" y="42" width="36" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <rect x="12" y="60" width="72" height="30" fill="#40d8e8"/><rect x="12" y="60" width="6" height="30" fill="#20b8c8"/><rect x="78" y="60" width="6" height="30" fill="#20b8c8"/><rect x="18" y="60" width="60" height="6" fill="#a0ffff"/><rect x="30" y="72" width="36" height="12" fill="#20b8c8"/>
          <rect x="24" y="66" width="6" height="6" fill="#ffff80"/><rect x="66" y="66" width="6" height="6" fill="#ffff80"/><rect x="42" y="78" width="12" height="6" fill="#ffff80"/>
          <rect x="0" y="60" width="12" height="30" fill="#40d8e8"/><rect x="84" y="60" width="12" height="30" fill="#40d8e8"/>
          <rect x="12" y="90" width="30" height="24" fill="#30c8d8"/><rect x="54" y="90" width="30" height="24" fill="#30c8d8"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/>
          <rect x="12" y="114" width="30" height="6" fill="#40d8e8"/><rect x="54" y="114" width="30" height="6" fill="#40d8e8"/>
          <rect x="84" y="28" width="6" height="6" fill="#ffff80"/><rect x="84" y="34" width="12" height="44" fill="#8040ff"/><rect x="78" y="46" width="6" height="6" fill="#a070ff"/><rect x="84" y="34" width="6" height="44" fill="#c090ff"/><rect x="84" y="78" width="12" height="6" fill="#4020a0"/>
        </svg>

        <!-- Stage 7: Lv60-69 ãƒã‚¶ãƒ©ã‚¤ãƒˆé˜²å…· -->
        <svg id="cs7" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="display:none">
          <defs><radialGradient id="cg7" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#c060ff" stop-opacity="0.2"/><stop offset="100%" stop-color="#c060ff" stop-opacity="0"/></radialGradient></defs>
          <rect x="0" y="0" width="96" height="96" fill="url(#cg7)"/>
          <ellipse cx="48" cy="90" rx="20" ry="4" fill="rgba(100,0,200,0.3)"/>
          <rect x="12" y="0" width="72" height="18" fill="#403040"/><rect x="6" y="12" width="6" height="24" fill="#403040"/><rect x="84" y="12" width="6" height="24" fill="#403040"/><rect x="12" y="18" width="72" height="6" fill="#301828"/><rect x="36" y="0" width="24" height="6" fill="#c060ff"/><rect x="42" y="6" width="12" height="6" fill="#e090ff"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/><rect x="18" y="12" width="60" height="12" fill="#2a1a28"/>
          <rect x="30" y="24" width="12" height="12" fill="#c060ff"/><rect x="54" y="24" width="12" height="12" fill="#c060ff"/><rect x="36" y="24" width="6" height="12" fill="#fff"/><rect x="60" y="24" width="6" height="12" fill="#fff"/>
          <rect x="30" y="42" width="12" height="6" fill="#3d2b1a"/><rect x="54" y="42" width="12" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <rect x="12" y="60" width="72" height="30" fill="#3a2838"/><rect x="12" y="60" width="6" height="30" fill="#2a1828"/><rect x="78" y="60" width="6" height="30" fill="#5a3858"/><rect x="18" y="60" width="60" height="6" fill="#5a3858"/><rect x="24" y="72" width="48" height="6" fill="#c060ff"/><rect x="30" y="84" width="36" height="6" fill="#c060ff"/><rect x="42" y="66" width="12" height="6" fill="#e090ff"/>
          <rect x="0" y="60" width="12" height="30" fill="#3a2838"/><rect x="84" y="60" width="12" height="30" fill="#3a2838"/>
          <rect x="12" y="90" width="30" height="24" fill="#2a1828"/><rect x="54" y="90" width="30" height="24" fill="#2a1828"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/><rect x="18" y="96" width="24" height="12" fill="#c060ff"/><rect x="54" y="96" width="24" height="12" fill="#c060ff"/>
          <rect x="12" y="114" width="30" height="6" fill="#3a2838"/><rect x="54" y="114" width="30" height="6" fill="#3a2838"/><rect x="12" y="114" width="30" height="3" fill="#ff8020"/><rect x="54" y="114" width="30" height="3" fill="#ff8020"/>
          <rect x="84" y="24" width="12" height="6" fill="#ff8020"/><rect x="84" y="30" width="12" height="48" fill="#3a2838"/><rect x="78" y="42" width="6" height="6" fill="#5a3858"/><rect x="84" y="30" width="6" height="48" fill="#5a3858"/><rect x="84" y="78" width="12" height="6" fill="#8040a0"/>
          <rect x="78" y="18" width="6" height="6" fill="#ff8020"/><rect x="72" y="12" width="6" height="6" fill="#ffa040"/>
        </svg>

        <!-- Stage 8: Lv70-79 ãƒãƒ³ãƒˆä»˜ãä¼èª¬è£…å‚™ -->
        <svg id="cs8" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="display:none">
          <defs><radialGradient id="cg8" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#ff8040" stop-opacity="0.25"/><stop offset="100%" stop-color="#ff8040" stop-opacity="0"/></radialGradient></defs>
          <rect x="0" y="0" width="96" height="96" fill="url(#cg8)"/>
          <ellipse cx="48" cy="90" rx="22" ry="5" fill="rgba(200,80,0,0.4)"/>
          <!-- Cape -->
          <rect x="12" y="60" width="6" height="36" fill="#c02020"/><rect x="78" y="60" width="6" height="36" fill="#c02020"/>
          <rect x="0" y="66" width="14" height="30" fill="#e03030"/><rect x="82" y="66" width="14" height="30" fill="#e03030"/>
          <!-- Helmet gold+red -->
          <rect x="12" y="0" width="72" height="18" fill="#d09020"/><rect x="6" y="12" width="6" height="24" fill="#d09020"/><rect x="84" y="12" width="6" height="24" fill="#d09020"/>
          <rect x="36" y="0" width="24" height="6" fill="#ff4040"/><rect x="42" y="6" width="12" height="6" fill="#ff8080"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/><rect x="18" y="12" width="60" height="12" fill="#b07810"/>
          <rect x="30" y="24" width="12" height="12" fill="#fff"/><rect x="54" y="24" width="12" height="12" fill="#fff"/><rect x="36" y="24" width="6" height="12" fill="#ff4000"/><rect x="60" y="24" width="6" height="12" fill="#ff4000"/>
          <rect x="30" y="42" width="36" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <!-- Gold/red chestplate -->
          <rect x="18" y="60" width="60" height="30" fill="#d09020"/><rect x="18" y="60" width="6" height="30" fill="#b07810"/><rect x="72" y="60" width="6" height="30" fill="#b07810"/><rect x="24" y="60" width="48" height="6" fill="#ffe060"/><rect x="30" y="72" width="36" height="12" fill="#b07810"/>
          <rect x="36" y="66" width="6" height="6" fill="#ff4040"/><rect x="54" y="66" width="6" height="6" fill="#ff4040"/><rect x="42" y="72" width="12" height="6" fill="#ff4040"/>
          <rect x="18" y="90" width="30" height="24" fill="#b07810"/><rect x="54" y="90" width="24" height="24" fill="#b07810"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/>
          <rect x="18" y="114" width="30" height="6" fill="#d09020"/><rect x="54" y="114" width="24" height="6" fill="#d09020"/>
          <!-- Legendary sword with fire -->
          <rect x="84" y="20" width="6" height="6" fill="#ff8020"/><rect x="84" y="12" width="6" height="6" fill="#ffc040"/><rect x="78" y="14" width="6" height="6" fill="#ff6000"/>
          <rect x="84" y="26" width="12" height="52" fill="#d09020"/><rect x="78" y="40" width="6" height="6" fill="#ffe060"/><rect x="84" y="26" width="6" height="52" fill="#ffe060"/>
          <rect x="84" y="78" width="12" height="6" fill="#a06010"/>
        </svg>

        <!-- Stage 9: Lv80-89 ç‚ã®ã‚ªãƒ¼ãƒ©ãƒ»ç¿¼ä»˜ã -->
        <svg id="cs9" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="display:none">
          <defs><radialGradient id="cg9" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#ff6020" stop-opacity="0.35"/><stop offset="100%" stop-color="#ff6020" stop-opacity="0"/></radialGradient></defs>
          <rect x="0" y="0" width="96" height="96" fill="url(#cg9)"/>
          <ellipse cx="48" cy="92" rx="24" ry="5" fill="rgba(255,80,0,0.5)"/>
          <!-- Wings -->
          <rect x="0" y="36" width="12" height="36" fill="#ff8020"/><rect x="0" y="36" width="6" height="36" fill="#ffc040"/><rect x="0" y="48" width="12" height="6" fill="#ffff80"/>
          <rect x="84" y="36" width="12" height="36" fill="#ff8020"/><rect x="90" y="36" width="6" height="36" fill="#ffc040"/><rect x="84" y="48" width="12" height="6" fill="#ffff80"/>
          <!-- Fire cape -->
          <rect x="12" y="60" width="6" height="36" fill="#ff6020"/><rect x="78" y="60" width="6" height="36" fill="#ff6020"/>
          <!-- Helmet -->
          <rect x="12" y="0" width="72" height="18" fill="#c03020"/><rect x="6" y="12" width="6" height="24" fill="#c03020"/><rect x="84" y="12" width="6" height="24" fill="#c03020"/>
          <rect x="36" y="0" width="24" height="6" fill="#ffff00"/><rect x="42" y="6" width="12" height="6" fill="#ffffff"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/><rect x="18" y="12" width="60" height="12" fill="#a02010"/>
          <rect x="30" y="24" width="12" height="12" fill="#ffff80"/><rect x="54" y="24" width="12" height="12" fill="#ffff80"/><rect x="36" y="24" width="6" height="12" fill="#ff4000"/><rect x="60" y="24" width="6" height="12" fill="#ff4000"/>
          <rect x="30" y="42" width="36" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <!-- Fire armor -->
          <rect x="18" y="60" width="60" height="30" fill="#c03020"/><rect x="18" y="60" width="6" height="30" fill="#a02010"/><rect x="72" y="60" width="6" height="30" fill="#a02010"/><rect x="24" y="60" width="48" height="6" fill="#ff8040"/><rect x="30" y="72" width="36" height="12" fill="#a02010"/>
          <rect x="36" y="66" width="6" height="6" fill="#ffff00"/><rect x="54" y="66" width="6" height="6" fill="#ffff00"/><rect x="42" y="72" width="12" height="6" fill="#ff8020"/>
          <rect x="18" y="90" width="30" height="24" fill="#a02010"/><rect x="54" y="90" width="24" height="24" fill="#a02010"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/>
          <rect x="12" y="114" width="36" height="6" fill="#ff8020"/><rect x="54" y="114" width="30" height="6" fill="#ff8020"/>
          <!-- Flaming sword -->
          <rect x="0" y="18" width="6" height="6" fill="#ffff00"/><rect x="0" y="12" width="6" height="6" fill="#ff8020"/>
          <rect x="0" y="24" width="12" height="48" fill="#c03020"/><rect x="6" y="30" width="6" height="6" fill="#ff8040"/><rect x="0" y="24" width="6" height="48" fill="#ff6020"/>
          <rect x="0" y="72" width="12" height="6" fill="#800010"/>
          <!-- Fire particles -->
          <rect x="84" y="6" width="6" height="6" fill="#ffff00"/><rect x="90" y="12" width="6" height="6" fill="#ff8020"/><rect x="0" y="6" width="6" height="6" fill="#ffc040"/>
        </svg>

        <!-- Stage 10: Lv90-99 å‹‰å¼·ã®è¦‡ç¥ -->
        <svg id="cs10" class="cstage" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="display:none">
          <defs>
            <radialGradient id="cg10a" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#ffffff" stop-opacity="0.3"/><stop offset="100%" stop-color="#ffffff" stop-opacity="0"/></radialGradient>
            <radialGradient id="cg10b" cx="50%" cy="80%" r="40%"><stop offset="0%" stop-color="#c060ff" stop-opacity="0.4"/><stop offset="100%" stop-color="#c060ff" stop-opacity="0"/></radialGradient>
          </defs>
          <rect x="0" y="0" width="96" height="96" fill="url(#cg10a)"/>
          <rect x="0" y="0" width="96" height="96" fill="url(#cg10b)"/>
          <ellipse cx="48" cy="92" rx="26" ry="6" fill="rgba(200,100,255,0.6)"/>
          <!-- God wings - rainbow -->
          <rect x="0" y="24" width="14" height="48" fill="#ff8020"/><rect x="0" y="30" width="10" height="6" fill="#ffff00"/><rect x="0" y="42" width="10" height="6" fill="#40ff80"/><rect x="0" y="54" width="10" height="6" fill="#40c8ff"/>
          <rect x="82" y="24" width="14" height="48" fill="#ff8020"/><rect x="86" y="30" width="10" height="6" fill="#ffff00"/><rect x="86" y="42" width="10" height="6" fill="#40ff80"/><rect x="86" y="54" width="10" height="6" fill="#40c8ff"/>
          <!-- God cape - rainbow -->
          <rect x="12" y="58" width="6" height="38" fill="#ff4040"/><rect x="78" y="58" width="6" height="38" fill="#c040ff"/>
          <!-- God crown -->
          <rect x="18" y="0" width="60" height="6" fill="#fff080"/><rect x="24" y="6" width="48" height="12" fill="#fff080"/><rect x="12" y="6" width="12" height="18" fill="#fff080"/><rect x="72" y="6" width="12" height="18" fill="#fff080"/>
          <rect x="18" y="0" width="12" height="6" fill="#ff4040"/><rect x="42" y="0" width="12" height="6" fill="#c040ff"/><rect x="66" y="0" width="12" height="6" fill="#40c8ff"/>
          <rect x="18" y="12" width="60" height="42" fill="#c8a070"/><rect x="18" y="12" width="60" height="12" fill="#c8b000"/>
          <!-- Rainbow eyes -->
          <rect x="30" y="24" width="12" height="12" fill="#fff"/><rect x="54" y="24" width="12" height="12" fill="#fff"/><rect x="36" y="24" width="6" height="12" fill="#c040ff"/><rect x="60" y="24" width="6" height="12" fill="#c040ff"/>
          <rect x="36" y="27" width="6" height="3" fill="#fff"/><rect x="60" y="27" width="6" height="3" fill="#fff"/>
          <rect x="30" y="42" width="36" height="6" fill="#3d2b1a"/>
          <rect x="36" y="54" width="24" height="6" fill="#c8a070"/>
          <!-- God armor - white/rainbow -->
          <rect x="18" y="60" width="60" height="30" fill="#e8f0ff"/><rect x="18" y="60" width="6" height="30" fill="#c0c8e0"/><rect x="72" y="60" width="6" height="30" fill="#c0c8e0"/><rect x="24" y="60" width="48" height="6" fill="#ffffff"/>
          <rect x="24" y="66" width="12" height="6" fill="#ff8080"/><rect x="42" y="66" width="12" height="6" fill="#c080ff"/><rect x="60" y="66" width="12" height="6" fill="#80c8ff"/>
          <rect x="30" y="72" width="36" height="12" fill="#c0c8e0"/>
          <rect x="0" y="60" width="12" height="30" fill="#e8f0ff"/><rect x="84" y="60" width="12" height="30" fill="#e8f0ff"/>
          <rect x="12" y="90" width="30" height="24" fill="#c0c8e0"/><rect x="54" y="90" width="30" height="24" fill="#c0c8e0"/><rect x="42" y="90" width="12" height="12" fill="#0d0f1a"/>
          <rect x="12" y="114" width="30" height="6" fill="#fff080"/><rect x="54" y="114" width="30" height="6" fill="#fff080"/>
          <rect x="12" y="114" width="30" height="3" fill="#ffffff"/><rect x="54" y="114" width="30" height="3" fill="#ffffff"/>
          <!-- God sword - rainbow -->
          <rect x="84" y="4" width="6" height="6" fill="#ffff00"/><rect x="90" y="4" width="6" height="6" fill="#ff8020"/><rect x="84" y="0" width="6" height="4" fill="#ffffff"/>
          <rect x="84" y="10" width="12" height="6" fill="#ff4040"/><rect x="84" y="16" width="12" height="6" fill="#ff8020"/><rect x="84" y="22" width="12" height="6" fill="#ffff00"/><rect x="84" y="28" width="12" height="6" fill="#40ff80"/><rect x="84" y="34" width="12" height="6" fill="#40c8ff"/><rect x="84" y="40" width="12" height="6" fill="#8040ff"/><rect x="84" y="46" width="12" height="6" fill="#ff40ff"/>
          <rect x="78" y="28" width="6" height="6" fill="#ffff80"/>
          <rect x="84" y="52" width="12" height="6" fill="#ffffff"/><rect x="84" y="58" width="12" height="6" fill="#e0e0e0"/>
          <rect x="84" y="64" width="12" height="6" fill="#806000"/>
          <!-- Star particles -->
          <rect x="0" y="0" width="6" height="6" fill="#ffff80"/><rect x="6" y="6" width="6" height="6" fill="#ff80ff"/><rect x="0" y="12" width="6" height="6" fill="#80ffff"/>
        </svg>

      </div>

      <div class="char-info">
        <div class="char-name" id="charName">ã¾ãªã³ã‚“</div>
        <div class="char-title" id="charTitle">ğŸŒ± è¦‹ç¿’ã„å†’é™ºè€…</div>
        <div class="char-lv">ãƒ¬ãƒ™ãƒ« <span id="lvNum">1</span></div>
        <div style="margin-top:4px">
          <div class="xp-labels"><span>çµŒé¨“å€¤</span><span id="xpTxt">0 / 10 XP</span></div>
          <div class="xp-bg"><div class="xp-fill" id="xpFill" style="width:0%"></div></div>
        </div>
      </div>
    </div>

    <div class="stats">
      <div class="stat"><div class="stat-icon">ğŸ“š</div><div class="stat-val" id="stTotal">0<span>åˆ†</span></div><div class="stat-lbl">ç·å­¦ç¿’æ™‚é–“</div></div>
      <div class="stat"><div class="stat-icon">âš¡</div><div class="stat-val" id="stToday">0<span>åˆ†</span></div><div class="stat-lbl">ä»Šæ—¥ã®å­¦ç¿’</div></div>
      <div class="stat"><div class="stat-icon">ğŸ”¥</div><div class="stat-val" id="stStreak">0<span>æ—¥</span></div><div class="stat-lbl">é€£ç¶šå­¦ç¿’</div></div>
      <div class="stat stat-avg"><div class="stat-icon">ğŸ“Š</div><div class="stat-val" id="stAvg">0<span>åˆ†</span></div><div class="stat-lbl">ï¼‘æ—¥å¹³å‡</div></div>
    </div>
  </div>

  <!-- Timer Card -->
  <div class="card">
    <h2>â± ã‚¿ã‚¤ãƒãƒ¼</h2>
    <div class="subj-row" id="subjRow">
      <button class="subj-btn active" data-s="ç®—æ•°">ğŸ“ ç®—æ•°</button>
      <button class="subj-btn" data-s="è‹±èª">ğŸ“– è‹±èª</button>
      <button class="subj-btn" data-s="ç†ç§‘">ğŸ”¬ ç†ç§‘</button>
      <button class="subj-btn" data-s="å›½èª">âœï¸ å›½èª</button>
      <button class="subj-btn" data-s="ç¤¾ä¼š">ğŸŒ ç¤¾ä¼š</button>
      <button class="subj-btn" data-s="ãƒ”ã‚¢ãƒ">ğŸ¹ ãƒ”ã‚¢ãƒ</button>
    </div>
    <div class="piano-panel" id="pianoPanel" style="display:none">
      <div style="font-family:'Zen Maru Gothic',sans-serif;font-size:0.85rem;color:#c878e0;margin-bottom:12px">ğŸµ ç·´ç¿’è¨­å®š</div>
      <div style="margin-bottom:10px"><label>ç·´ç¿’æ›²</label><input type="text" id="pianoSong" placeholder="ä¾‹: ãƒãƒƒãƒ ã‚¤ãƒ³ãƒ™ãƒ³ã‚·ãƒ§ãƒ³ No.1"></div>
      <div style="display:-webkit-flex;display:flex;gap:8px;-webkit-align-items:center;align-items:center">
        <div style="-webkit-flex:1;flex:1"><label>é›£æ˜“åº¦</label>
          <div class="diff-row" id="diffRow">
            <button class="diff-btn active" data-d="åˆç´š">åˆç´š</button>
            <button class="diff-btn" data-d="ä¸­ç´š">ä¸­ç´š</button>
            <button class="diff-btn" data-d="ä¸Šç´š">ä¸Šç´š</button>
          </div>
        </div>
        <div style="-webkit-flex:1;flex:1"><label>XPå€ç‡</label><div class="xp-rate" id="xpRate">Ã—1.0</div></div>
      </div>
      <div style="margin-top:10px"><label>ç·´ç¿’ãƒ¡ãƒ¢</label><textarea id="pianoMemo" rows="2" placeholder="ä¾‹: å³æ‰‹ã ã‘ã§3å›ã€ä¸¡æ‰‹ã§2å›..."></textarea></div>
    </div>
    <div class="timer-display" id="timerDisp">00:00</div>
    <div class="timer-sub" id="timerSub">ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦å­¦ç¿’ã‚’å§‹ã‚ã‚ˆã†ï¼</div>
    <div class="timer-btns">
      <button class="btn btn-start" id="btnStart">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button class="btn btn-stop" id="btnStop" style="display:none">â¸ ã‚¹ãƒˆãƒƒãƒ—</button>
      <button class="btn btn-reset" id="btnReset">â†º</button>
    </div>
  </div>

  <!-- Log -->
  <div class="card">
    <h2>ğŸ“‹ ä»Šæ—¥ã®è¨˜éŒ²</h2>
    <div id="logList"><div class="empty-log">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å‹‰å¼·ã‚’å§‹ã‚ã‚ˆã†ï¼</div></div>
  </div>

  <!-- Achievements -->
  <div class="card"><h2>ğŸ† å®Ÿç¸¾</h2><div class="ach-grid" id="achGrid"></div></div>

</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Level Up Overlay -->
<div class="overlay lu-bg" id="luOverlay">
  <div class="lu-box">
    <div class="big">LEVEL UP!</div>
    <div class="lnum" id="luNum">2</div>
    <div class="ltitle" id="luTitle"></div>
    <div class="lu-btns">
      <button class="lu-btn" id="luClose" style="background:var(--surface);color:var(--dim);border:1px solid var(--border)">ã¨ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
// ===== LEVELS (Lv99 MAX = 500æ™‚é–“) =====
var LEVELS = [
  {lv:1, xp:10, title:'ğŸŒ± è¦‹ç¿’ã„å†’é™ºè€…'},
  {lv:2, xp:20, title:'ğŸªµ æœ¨ã“ã‚Šã®å¼Ÿå­'},
  {lv:3, xp:30, title:'ğŸ—¡ è¦‹ç¿’ã„æˆ¦å£«'},
  {lv:4, xp:52, title:'âš” é©é§ã®æˆ¦å£«'},
  {lv:5, xp:84, title:'ğŸ›¡ é‰„ã®è¦‹ç¿’ã„'},
  {lv:6, xp:126, title:'ğŸ”± é‰„ã®æˆ¦å£«'},
  {lv:7, xp:177, title:'ğŸ’ é‰„ã®é¨å£«'},
  {lv:8, xp:237, title:'ğŸŒŸ ç²¾é‹­ã®æˆ¦å£«'},
  {lv:9, xp:307, title:'ğŸ”¥ é‹¼ã®å‹‡è€…'},
  {lv:10, xp:387, title:'ğŸ¥ˆ çŸ³ã®å®ˆè­·è€…'},
  {lv:11, xp:477, title:'ğŸ›¡ çŸ³ã®é¨å£«'},
  {lv:12, xp:578, title:'ğŸ”® çŸ³ã®è³¢è€…'},
  {lv:13, xp:689, title:'âš¡ çŸ³ã®æˆ¦å£«'},
  {lv:14, xp:811, title:'ğŸŒŠ çŸ³ã®å‹‡è€…'},
  {lv:15, xp:944, title:'ğŸ¥‡ é»„é‡‘ã®æˆ¦å£«'},
  {lv:16, xp:1088, title:'ğŸ‘‘ é»„é‡‘ã®é¨å£«'},
  {lv:17, xp:1244, title:'âœ¨ é»„é‡‘ã®è³¢è€…'},
  {lv:18, xp:1410, title:'ğŸŒˆ é»„é‡‘ã®å‹‡è€…'},
  {lv:19, xp:1589, title:'ğŸ† é»„é‡‘ã®è¦‡è€…'},
  {lv:20, xp:1778, title:'ğŸ’ ãƒ€ã‚¤ãƒ¤ã®æˆ¦å£«'},
  {lv:21, xp:1980, title:'ğŸ”· ãƒ€ã‚¤ãƒ¤ã®é¨å£«'},
  {lv:22, xp:2193, title:'ğŸ’  ãƒ€ã‚¤ãƒ¤ã®è³¢è€…'},
  {lv:23, xp:2419, title:'ğŸŒ€ ãƒ€ã‚¤ãƒ¤ã®å‹‡è€…'},
  {lv:24, xp:2656, title:'â­ ãƒ€ã‚¤ãƒ¤ã®è¦‡è€…'},
  {lv:25, xp:2906, title:'ğŸŒŸ ãƒ€ã‚¤ãƒ¤ç²¾é‹­'},
  {lv:26, xp:3167, title:'ğŸ’« ãƒ€ã‚¤ãƒ¤çŒ›è€…'},
  {lv:27, xp:3442, title:'ğŸ”¹ ãƒ€ã‚¤ãƒ¤ç‹è€…'},
  {lv:28, xp:3728, title:'ğŸŒ  ãƒ€ã‚¤ãƒ¤ä¼èª¬'},
  {lv:29, xp:4027, title:'ğŸ¯ ãƒ€ã‚¤ãƒ¤ã®ç¥'},
  {lv:30, xp:4339, title:'ğŸ”® ãƒã‚¶ãƒ©ã‚¤ãƒˆæˆ¦å£«'},
  {lv:31, xp:4664, title:'ğŸŒ‘ ãƒã‚¶ãƒ©ã‚¤ãƒˆé¨å£«'},
  {lv:32, xp:5001, title:'ğŸ”´ ãƒã‚¶ãƒ©ã‚¤ãƒˆè³¢è€…'},
  {lv:33, xp:5352, title:'ğŸŒ‹ ãƒã‚¶ãƒ©ã‚¤ãƒˆå‹‡è€…'},
  {lv:34, xp:5715, title:'ğŸ”¥ ãƒã‚¶ãƒ©ã‚¤ãƒˆè¦‡è€…'},
  {lv:35, xp:6091, title:'ğŸ’œ ãƒã‚¶ãƒ©ã‚¤ãƒˆç²¾é‹­'},
  {lv:36, xp:6481, title:'ğŸŸ£ ãƒã‚¶ãƒ©ã‚¤ãƒˆçŒ›è€…'},
  {lv:37, xp:6883, title:'âš« ãƒã‚¶ãƒ©ã‚¤ãƒˆç‹è€…'},
  {lv:38, xp:7299, title:'ğŸŒŒ ãƒã‚¶ãƒ©ã‚¤ãƒˆä¼èª¬'},
  {lv:39, xp:7729, title:'ğŸ‘ ãƒã‚¶ãƒ©ã‚¤ãƒˆã®ç¥'},
  {lv:40, xp:8171, title:'ğŸŒ™ æœˆã®å®ˆè­·è€…'},
  {lv:41, xp:8627, title:'âš¡ é›·ã®æˆ¦å£«'},
  {lv:42, xp:9097, title:'ğŸŒŠ åµã®å‹‡è€…'},
  {lv:43, xp:9580, title:'ğŸ” å±±ã®ç‹è€…'},
  {lv:44, xp:10077, title:'ğŸŒº èŠ±ã®è–äºº'},
  {lv:45, xp:10588, title:'ğŸ¦ ç™¾ç£ã®ç‹'},
  {lv:46, xp:11113, title:'ğŸ‰ ç«œé¨å£«'},
  {lv:47, xp:11651, title:'ğŸŒ  æµæ˜Ÿã®å‹‡è€…'},
  {lv:48, xp:12204, title:'ğŸ† é»„é‡‘ä¼èª¬'},
  {lv:49, xp:12770, title:'ğŸ“ å­¦å•ã®é”äºº'},
  {lv:50, xp:13350, title:'ğŸš€ å®‡å®™ã®æ—…äºº'},
  {lv:51, xp:13945, title:'ğŸŒŒ éŠ€æ²³ã®æ¢æ±‚è€…'},
  {lv:52, xp:14553, title:'ğŸ’¡ é–ƒãã®å¤©æ‰'},
  {lv:53, xp:15176, title:'ğŸ¨ å‰µé€ ã®ç¥'},
  {lv:54, xp:15813, title:'ğŸ—º å†’é™ºç‹'},
  {lv:55, xp:16465, title:'ğŸ¦… å¤©ç©ºã®ç‹è€…'},
  {lv:56, xp:17130, title:'ğŸŒ‹ å¤§åœ°ã®åŠ›'},
  {lv:57, xp:17811, title:'â„ æ°·ã®å‹‡è€…'},
  {lv:58, xp:18505, title:'ğŸ”‘ é‹å‘½ã®éµ'},
  {lv:59, xp:19214, title:'ğŸŒ å¤ªé™½ã®ä½¿è€…'},
  {lv:60, xp:19938, title:'â­ æ˜Ÿã®å­'},
  {lv:61, xp:20677, title:'ğŸ¦Š çŸ¥æµã®ç‹'},
  {lv:62, xp:21430, title:'ğŸº å­¤é«˜ã®ç‹¼'},
  {lv:63, xp:22197, title:'ğŸ¦‰ æ™ºæ…§ã®æ¢Ÿ'},
  {lv:64, xp:22980, title:'ğŸ² ç¥é¾ã®åŠ è­·'},
  {lv:65, xp:23777, title:'ğŸŒ€ æ™‚ã®æˆ¦å£«'},
  {lv:66, xp:24590, title:'ğŸ”­ å®‡å®™ã‚’è¦‹ã‚‹ç›®'},
  {lv:67, xp:25417, title:'ğŸŒŸ äº”ã¤æ˜Ÿã®å°†'},
  {lv:68, xp:26259, title:'âš¡ ç¥é€Ÿã®æˆ¦å£«'},
  {lv:69, xp:27116, title:'ğŸ”¥ æ¥­ç«ã®é­”ç‹'},
  {lv:70, xp:27988, title:'ğŸŒŠ æ·±æµ·ã®ç¥'},
  {lv:71, xp:28875, title:'ğŸŒª åµã‚’å‘¼ã¶è€…'},
  {lv:72, xp:29777, title:'ğŸ¯ åŸã®ä¸»'},
  {lv:73, xp:30695, title:'ğŸ¦¸ å­¦ç¿’ãƒ’ãƒ¼ãƒ­ãƒ¼'},
  {lv:74, xp:31627, title:'ğŸ¦¹ ä¼èª¬ã®å‹‡è€…'},
  {lv:75, xp:32575, title:'ğŸŒ™ å¤œã®æ±‚é“è€…'},
  {lv:76, xp:33539, title:'âš” åŒå‰£ã®é”äºº'},
  {lv:77, xp:34517, title:'ğŸ›¡ é‰„å£ã®å®ˆè­·'},
  {lv:78, xp:35511, title:'ğŸ’« å¥‡è·¡ã‚’èµ·ã“ã™è€…'},
  {lv:79, xp:36520, title:'ğŸ¦‹ è¼ªå»»ã®è¶'},
  {lv:80, xp:37545, title:'ğŸ‰ å¤©ç¿”ã‘ã‚‹é¾'},
  {lv:81, xp:38585, title:'ğŸ‘ å…¨çŸ¥ã®ç›®'},
  {lv:82, xp:39641, title:'âš— è³¢è€…ã®çŸ³'},
  {lv:83, xp:40712, title:'ğŸ”® æ°´æ™¶ã®äºˆè¨€è€…'},
  {lv:84, xp:41799, title:'ğŸŒ  å½¼æ–¹ã®æ˜Ÿ'},
  {lv:85, xp:42902, title:'ğŸ’¡ å®‡å®™ã®çœŸç†'},
  {lv:86, xp:44020, title:'ğŸŒ ä¸–ç•Œã®å‰µé€ è€…'},
  {lv:87, xp:45154, title:'ğŸš€ å¤©ç©ºã‚’è¶…ãˆã—è€…'},
  {lv:88, xp:46304, title:'ğŸŒŒ å®‡å®™ã®æ”¯é…è€…'},
  {lv:89, xp:47469, title:'ğŸ’« å…‰ã‚’è¶…ãˆã—è€…'},
  {lv:90, xp:48651, title:'âš¡ é›·ç¥ã®åŒ–èº«'},
  {lv:91, xp:49848, title:'ğŸ”¥ ç‚ç¥ã®ç”³ã—å­'},
  {lv:92, xp:51061, title:'ğŸŒŠ æµ·ç¥ã®åŒ–èº«'},
  {lv:93, xp:52290, title:'ğŸŒª é¢¨ç¥ã®ä½¿è€…'},
  {lv:94, xp:53535, title:'â„ æ°·ç¥ã®å®ˆè­·'},
  {lv:95, xp:54796, title:'ğŸŒŸ æ˜Ÿç¥ã®åŠ è­·'},
  {lv:96, xp:56073, title:'ğŸ’ æ°¸é ãªã‚‹çŸ¥è­˜'},
  {lv:97, xp:57366, title:'ğŸ† è‡³é«˜ã®å­¦è€…'},
  {lv:98, xp:58675, title:'ğŸ‘‘ å‹‰å¼·ã®ç¥æ§˜'},
  {lv:99, xp:60000, title:'ğŸ‘‘âœ¨ å‹‰å¼·ã®è¦‡ç¥'}
];

var ACHS = [
  {id:'a1', icon:'ğŸ¯', name:'æœ€åˆã®ä¸€æ­©',   ok:function(s){return s.total>=5;}},
  {id:'a2', icon:'ğŸŒŸ', name:'30åˆ†é”æˆ',     ok:function(s){return s.total>=30;}},
  {id:'a3', icon:'â°', name:'1æ™‚é–“ã®å£',    ok:function(s){return s.total>=60;}},
  {id:'a4', icon:'ğŸ’ª', name:'5æ™‚é–“çªç ´',    ok:function(s){return s.total>=300;}},
  {id:'a5', icon:'ğŸš€', name:'10æ™‚é–“çªç ´',   ok:function(s){return s.total>=600;}},
  {id:'a6', icon:'ğŸ”¥', name:'3æ—¥é€£ç¶š',      ok:function(s){return s.streak>=3;}},
  {id:'a7', icon:'ğŸ’', name:'ä¸€é€±é–“é€£ç¶š',   ok:function(s){return s.streak>=7;}},
  {id:'a8', icon:'ğŸ†', name:'Lv.10åˆ°é”',    ok:function(s){return s.level>=10;}},
  {id:'a9', icon:'â­', name:'Lv.30åˆ°é”',    ok:function(s){return s.level>=30;}},
  {id:'a10',icon:'ğŸ’ ', name:'Lv.50åˆ°é”',    ok:function(s){return s.level>=50;}},
  {id:'a11',icon:'ğŸŒˆ', name:'Lv.99åˆ°é”',    ok:function(s){return s.level>=99;}},
  {id:'a12',icon:'ğŸ¹', name:'ãƒ”ã‚¢ãƒå…¥é–€',   ok:function(s){return (s.pianoMin||0)>=10;}},
  {id:'a13',icon:'ğŸµ', name:'ãƒ¡ãƒ­ãƒ‡ã‚£ã‚¹ãƒˆ', ok:function(s){return (s.pianoMin||0)>=60;}},
  {id:'a14',icon:'ğŸ¶', name:'ãƒ”ã‚¢ãƒåæ‰‹',   ok:function(s){return (s.pianoMin||0)>=300;}},
  {id:'a15',icon:'ğŸ‘‘', name:'ä¸Šç´šæ›²ã‚¯ãƒªã‚¢', ok:function(s){return (s.pianoAdv||0)>=1;}}
];

var SCOLS = {ç®—æ•°:'#f0c040',è‹±èª:'#40c8f0',ç†ç§‘:'#5affa0',å›½èª:'#e05a8a',ç¤¾ä¼š:'#c87840',ãƒ”ã‚¢ãƒ:'#c878e0'};
var PRATE = {åˆç´š:1.0, ä¸­ç´š:1.5, ä¸Šç´š:2.0};

// ===== STATE =====
function saveState() { localStorage.setItem('sq3', JSON.stringify(state)); }

var raw = localStorage.getItem('sq3');
var state;
try { state = raw ? JSON.parse(raw) : null; } catch(e) { state = null; localStorage.removeItem('sq3'); }

state = state || {total:0,today:0,streak:1,xp:0,level:1,lastShownLevel:1,logs:[],achs:[],lastDate:new Date().toDateString(),daily:{},pianoMin:0,pianoAdv:0};

if (!state.daily) { state.daily = {}; }
if (!state.achs) { state.achs = []; }
if (state.lastShownLevel == null) { state.lastShownLevel = state.level; }

/* èµ·å‹•æ™‚ã¯å¿…ãšé–‰ã˜ã‚‹ï¼ˆclassæ®‹ã‚Šå¯¾ç­–ï¼‰ */
document.getElementById('luOverlay').classList.remove('show');

if (state.lastDate !== new Date().toDateString()) {
  if (state.today > 0) { state.daily[state.lastDate] = (state.daily[state.lastDate]||0) + state.today; }
  state.today = 0;
  state.lastDate = new Date().toDateString();
  saveState();
}

var timerSec = 0, timerRun = false, timerInt = null;
var selSubj = 'ç®—æ•°', selDiff = 'åˆç´š';
var toastTm = null;

// ===== RENDER =====
function render() {
  var lv = LEVELS[Math.min(state.level-1, LEVELS.length-1)];
  // Stage: 10æ®µéš (each 10 levels)
  var stage = Math.min(Math.ceil(state.level/10), 10);
  if (stage < 1) { stage = 1; }
  for (var i=1; i<=10; i++) {
    var el = document.getElementById('cs'+i);
    if (el) { el.style.display = (i===stage) ? 'block' : 'none'; }
  }
  document.getElementById('charTitle').textContent = lv.title;
  document.getElementById('lvNum').textContent = state.level;
  var prevXp = state.level > 1 ? LEVELS[state.level-2].xp : 0;
  var span = lv.xp - prevXp;
  var cur = state.xp - prevXp;
  var pct = span > 0 ? Math.min(100, Math.round(cur/span*100)) : 100;
  document.getElementById('xpTxt').textContent = state.xp + ' / ' + lv.xp + ' XP';
  document.getElementById('xpFill').style.width = pct + '%';
  document.getElementById('stTotal').innerHTML = state.total + '<span>åˆ†</span>';
  document.getElementById('stToday').innerHTML = state.today + '<span>åˆ†</span>';
  document.getElementById('stStreak').innerHTML = state.streak + '<span>æ—¥</span>';
  var days = [];
  for (var k in state.daily) { if (state.daily.hasOwnProperty(k)) { days.push(state.daily[k]); } }
  if (state.today > 0 && !state.daily[new Date().toDateString()]) { days.push(state.today); }
  var avg = days.length > 0 ? Math.round(days.reduce(function(a,b){return a+b;},0)/days.length) : 0;
  document.getElementById('stAvg').innerHTML = avg + '<span>åˆ†</span>';
  renderLog(); renderAch();
}

function renderLog() {
  var el = document.getElementById('logList');
  var today = new Date().toDateString();
  var logs = [];
  for (var i=0; i<state.logs.length; i++) { if (state.logs[i].date===today) { logs.push(state.logs[i]); } }
  logs = logs.slice(-6).reverse();
  if (logs.length===0) { el.innerHTML = '<div class="empty-log">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å‹‰å¼·ã‚’å§‹ã‚ã‚ˆã†ï¼</div>'; return; }
  var html = '';
  for (var j=0; j<logs.length; j++) {
    var l = logs[j];
    var extra = '';
    if (l.subj==='ãƒ”ã‚¢ãƒ' && (l.song||l.diff)) { extra = '<div style="font-size:0.68rem;color:#c878e0;margin-top:2px">'+(l.song?'ğŸµ '+l.song:'')+(l.diff?' ['+l.diff+']':'')+'</div>'; }
    html += '<div class="log-item"><div class="log-dot" style="background:'+(SCOLS[l.subj]||'#aaa')+'"></div><div class="log-subj">'+l.subj+extra+'</div><div style="display:-webkit-flex;display:flex;gap:8px"><div class="log-time">'+l.min+'åˆ†</div><div class="log-xp">+'+l.xp+'XP</div></div></div>';
  }
  el.innerHTML = html;
}

function renderAch() {
  var html = '';
  for (var i=0; i<ACHS.length; i++) {
    var a = ACHS[i];
    var on = state.achs.indexOf(a.id) >= 0;
    html += '<div class="ach-item'+(on?' on':'')+'"><div class="ach-icon">'+a.icon+'</div><div class="ach-name">'+a.name+'</div></div>';
  }
  document.getElementById('achGrid').innerHTML = html;
}

// ===== TIMER =====
function fmt(s) {
  var m = Math.floor(s/60), sc = s%60;
  return (m<10?'0':'')+m+':'+(sc<10?'0':'')+sc;
}
function startTimer() {
  if (timerRun) { return; }
  timerRun = true;
  document.getElementById('btnStart').style.display = 'none';
  document.getElementById('btnStop').style.display = 'inline-block';
  document.getElementById('timerDisp').className = 'timer-display running';
  document.getElementById('timerSub').textContent = selSubj==='ãƒ”ã‚¢ãƒ' ? 'ğŸ¹ ãƒ”ã‚¢ãƒç·´ç¿’ä¸­... ['+selDiff+']' : selSubj+'ã‚’å‹‰å¼·ä¸­...';
  timerInt = setInterval(function() {
    timerSec++;
    document.getElementById('timerDisp').textContent = fmt(timerSec);
    if (timerSec % 300 === 0) { addSession(5, false); }
  }, 1000);
}
function stopTimer() {
  if (!timerRun) { return; }
  clearInterval(timerInt); timerInt = null; timerRun = false;
  document.getElementById('btnStart').style.display = 'inline-block';
  document.getElementById('btnStop').style.display = 'none';
  document.getElementById('timerDisp').className = 'timer-display';
  document.getElementById('timerSub').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦å­¦ç¿’ã‚’å§‹ã‚ã‚ˆã†ï¼';
  var mins = Math.floor(timerSec/60);
  if (mins >= 1) { addSession(mins, true); timerSec = timerSec%60; document.getElementById('timerDisp').textContent = fmt(timerSec); }
  else { showToast('âš ï¸ 1åˆ†ä»¥ä¸Šã§è¨˜éŒ²ã•ã‚Œã¾ã™'); }
}
function resetTimer() {
  if (timerRun) { stopTimer(); }
  timerSec = 0;
  document.getElementById('timerDisp').textContent = '00:00';
}

// ===== SESSION =====
function addSession(mins, manual) {
  var isPiano = (selSubj==='ãƒ”ã‚¢ãƒ');
  var rate = isPiano ? PRATE[selDiff] : 1.0;
  var gained = Math.round(mins * 2 * rate);
  state.total += mins; state.today += mins;
  var today = new Date().toDateString();
  state.daily[today] = (state.daily[today]||0) + mins;
  if (isPiano) {
    state.pianoMin = (state.pianoMin||0) + mins;
    if (selDiff==='ä¸Šç´š' && manual) { state.pianoAdv = (state.pianoAdv||0)+1; }
  }
  var oldLv = state.level;
  state.xp += gained;
  while (state.level < LEVELS.length && state.xp >= LEVELS[state.level-1].xp) { state.level++; }
  if (manual) {
    var entry = {subj:selSubj, min:mins, xp:gained, date:new Date().toDateString()};
    if (isPiano) { entry.song = document.getElementById('pianoSong').value; entry.diff = selDiff; entry.memo = document.getElementById('pianoMemo').value; }
    state.logs.push(entry);
    var label = rate>1 ? ' (x'+rate+' bonus!)' : '';
    showToast('âœ¨ '+mins+'åˆ†å­¦ç¿’ï¼ +'+gained+' XP'+label);
  }
  checkAchs();

  /* â˜…é‡è¦ï¼šåŒã˜ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã‚’èµ·å‹•æ™‚ã«å†è¡¨ç¤ºã—ãªã„ */
  if (state.level > oldLv && state.level > state.lastShownLevel) {
    state.lastShownLevel = state.level;
    (function(lv){ setTimeout(function(){ showLevelUp(lv); }, 600); })(state.level);
  }

  saveState(); render();
}

// ===== ACHIEVEMENTS =====
function checkAchs() {
  for (var i=0; i<ACHS.length; i++) {
    var a = ACHS[i];
    if (state.achs.indexOf(a.id)<0 && a.ok(state)) {
      state.achs.push(a.id);
      (function(n,ic){ setTimeout(function(){showToast('ğŸ† å®Ÿç¸¾è§£é™¤ï¼ã€Œ'+n+'ã€'+ic);},1200); })(a.name,a.icon);
    }
  }
}

// ===== LEVEL UP =====
function showLevelUp(lv) {
  var ldata = LEVELS[Math.min(lv-1,LEVELS.length-1)];
  document.getElementById('luNum').textContent = lv;
  document.getElementById('luTitle').textContent = 'ç§°å·: '+ldata.title;
  document.getElementById('luOverlay').classList.add('show');
  spawnConfetti();
}
function closeLU() { document.getElementById('luOverlay').classList.remove('show'); }

// ===== TOAST =====
function showToast(msg) {
  var el = document.getElementById('toast');
  el.textContent = msg; el.className = 'toast show';
  if (toastTm) { clearTimeout(toastTm); }
  toastTm = setTimeout(function(){ el.className='toast'; }, 2800);
}

// ===== CONFETTI =====
function spawnConfetti() {
  var cols = ['#f0c040','#e05a8a','#40c8f0','#5affa0','#c880f0'];
  for (var i=0; i<50; i++) {
    (function(){
      var p = document.createElement('div');
      p.className = 'particle';
      p.style.left = Math.random()*100+'vw'; p.style.top = '-10px';
      p.style.background = cols[Math.floor(Math.random()*cols.length)];
      var dur = (1.5+Math.random()*2)+'s';
      p.style.webkitAnimationDuration = dur; p.style.animationDuration = dur;
      var delay = (Math.random()*0.5)+'s';
      p.style.webkitAnimationDelay = delay; p.style.animationDelay = delay;
      document.body.appendChild(p);
      setTimeout(function(){ if(p.parentNode){p.parentNode.removeChild(p);} },4000);
    })();
  }
}

// ===== INIT BUTTONS =====
function initSubjBtns() {
  var btns = document.querySelectorAll('#subjRow .subj-btn');
  for (var i=0; i<btns.length; i++) {
    (function(btn){
      btn.addEventListener('click', function(){
        for (var j=0; j<btns.length; j++) { btns[j].className='subj-btn'; }
        btn.className = 'subj-btn active';
        selSubj = btn.getAttribute('data-s');
        document.getElementById('pianoPanel').style.display = (selSubj==='ãƒ”ã‚¢ãƒ')?'block':'none';
        if (selSubj==='ãƒ”ã‚¢ãƒ') { document.getElementById('timerSub').textContent='ãƒ”ã‚¢ãƒç·´ç¿’ã®è¨­å®šã‚’ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆï¼'; }
      });
    })(btns[i]);
  }
}
function initDiffBtns() {
  var btns = document.querySelectorAll('#diffRow .diff-btn');
  for (var i=0; i<btns.length; i++) {
    (function(btn){
      btn.addEventListener('click', function(){
        for (var j=0; j<btns.length; j++) { btns[j].className='diff-btn'; }
        btn.className = 'diff-btn active';
        selDiff = btn.getAttribute('data-d');
        document.getElementById('xpRate').textContent = 'Ã—'+PRATE[selDiff].toFixed(1);
      });
    })(btns[i]);
  }
}

// ===== WIRE UP =====
document.getElementById('btnStart').addEventListener('click', startTimer);
document.getElementById('btnStop').addEventListener('click', stopTimer);
document.getElementById('btnReset').addEventListener('click', resetTimer);
document.getElementById('luClose').addEventListener('click', closeLU);

initSubjBtns();
initDiffBtns();
render();
</script>
</body>
</html>
